---
# Playbook for SSH Key generation
- name: SSH key generation playbook
  hosts: localhost
  connection: local

  tasks:
  - name: SSH Key Generation
    community.crypto.openssh_keypair:
      path: ~/.ssh/id_rsa_myproject
      type: rsa
      size: 4096
      state: present
      force: no


# Playbook for SSH Key deployment
- name: SSH Key Deployment playbook
  hosts: all
  become: yes
  
  tasks:
  - name: Create sample user
    user:
      name: user
      shell: /bin/bash
      append: yes
      password: "{{ 'password' | password_hash('sha512') }}"

  - name: Deploying SSH key
    ansible.posix.authorized_key:
      user: user
      key: "{{ lookup('file', '~/.ssh/id_rsa_myproject') }}"
      state: present